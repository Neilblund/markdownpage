<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>FAQs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="logit_hw_faq_files/libs/clipboard/clipboard.min.js"></script>
<script src="logit_hw_faq_files/libs/quarto-html/quarto.js"></script>
<script src="logit_hw_faq_files/libs/quarto-html/popper.min.js"></script>
<script src="logit_hw_faq_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="logit_hw_faq_files/libs/quarto-html/anchor.min.js"></script>
<link href="logit_hw_faq_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="logit_hw_faq_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="logit_hw_faq_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="logit_hw_faq_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="logit_hw_faq_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#how-do-i-get-coefficentsodds-ratiosand-percent-change-to-odds-from-a-logit" id="toc-how-do-i-get-coefficentsodds-ratiosand-percent-change-to-odds-from-a-logit" class="nav-link active" data-scroll-target="#how-do-i-get-coefficentsodds-ratiosand-percent-change-to-odds-from-a-logit">How do I get coefficents/odds ratios/and percent change to odds from a logit?</a></li>
  <li><a href="#how-do-i-get-the-p-value-for-the-model-chi2" id="toc-how-do-i-get-the-p-value-for-the-model-chi2" class="nav-link" data-scroll-target="#how-do-i-get-the-p-value-for-the-model-chi2">How do I get the P-value for the model <span class="math inline">\(\chi^2\)</span>?</a></li>
  <li><a href="#how-do-i-update-the-design-data" id="toc-how-do-i-update-the-design-data" class="nav-link" data-scroll-target="#how-do-i-update-the-design-data">How do I update the design data?</a></li>
  <li><a href="#why-is-the-predict-function-giving-me-an-error-like-arguments-imply-differing-number-of-rows-or-newdata-had-x-rows-but-variables-found-have-x-rows" id="toc-why-is-the-predict-function-giving-me-an-error-like-arguments-imply-differing-number-of-rows-or-newdata-had-x-rows-but-variables-found-have-x-rows" class="nav-link" data-scroll-target="#why-is-the-predict-function-giving-me-an-error-like-arguments-imply-differing-number-of-rows-or-newdata-had-x-rows-but-variables-found-have-x-rows">Why is the predict function giving me an error like “arguments imply differing number of rows…” or “‘newdata’ had X rows but variables found have X rows”?</a></li>
  <li><a href="#how-do-i-calculcate-the-switchover-point" id="toc-how-do-i-calculcate-the-switchover-point" class="nav-link" data-scroll-target="#how-do-i-calculcate-the-switchover-point">How do I calculcate the switchover point?</a></li>
  <li><a href="#how-do-i-do-the-3d-plot-again" id="toc-how-do-i-do-the-3d-plot-again" class="nav-link" data-scroll-target="#how-do-i-do-the-3d-plot-again">How do I do the 3d plot again?</a>
  <ul class="collapse">
  <li><a href="#with-predict" id="toc-with-predict" class="nav-link" data-scroll-target="#with-predict">with predict</a></li>
  <li><a href="#pred_ci-with-xtabs" id="toc-pred_ci-with-xtabs" class="nav-link" data-scroll-target="#pred_ci-with-xtabs">pred_ci with xtabs</a></li>
  <li><a href="#with-inverse.logit" id="toc-with-inverse.logit" class="nav-link" data-scroll-target="#with-inverse.logit">with inverse.logit</a></li>
  </ul></li>
  <li><a href="#error-in-glm-fit-something-about-not-being-meaningful-for-factors" id="toc-error-in-glm-fit-something-about-not-being-meaningful-for-factors" class="nav-link" data-scroll-target="#error-in-glm-fit-something-about-not-being-meaningful-for-factors">error in glm fit … something about not being meaningful for factors</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">FAQs</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="how-do-i-get-coefficentsodds-ratiosand-percent-change-to-odds-from-a-logit" class="level1">
<h1>How do I get coefficents/odds ratios/and percent change to odds from a logit?</h1>
<p>Remember that the output from <code>summary</code> is showing you the effect of a one unit increase in X on the logged odds of <span class="math inline">\(Y=1\)</span>. Logit coefficients can take on any value from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>. An odds ratio of 0 means there is no effect of X on Y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = Y ~ X1 + X2, family = binomial, data = fakedata)

Coefficients:
(Intercept)           X1           X2  
    0.02856      1.87820     -3.63434  

Degrees of Freedom: 999 Total (i.e. Null);  997 Residual
Null Deviance:      1140 
Residual Deviance: 491.9    AIC: 497.9</code></pre>
</div>
</div>
<p>Using the <code>orci</code> function will transform the logit coefficients to odds ratios. Odds ratios can take any value from <span class="math inline">\(0\)</span> to <span class="math inline">\(\infty\)</span>. An odds ratio of 1 means that there is no effect of X on Y. A number below 1 indicates a negative effect, and a number above 1 indicates a positive effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">orci</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            OddsRatio 2.5 % 97.5 %
(Intercept)     1.029 0.714  1.478
X1              6.542 4.819  9.141
X2              0.026 0.015  0.044</code></pre>
</div>
</div>
<p>You can convert the odds ratios to a percent change in the odds of Y by running:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">orci</span>(model) <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            OddsRatio 2.5 % 97.5 %
(Intercept)       2.9 -28.6   47.8
X1              554.2 381.9  814.1
X2              -97.4 -98.5  -95.6</code></pre>
</div>
</div>
<p>Lastly, the <code>inverse.logit</code>, <code>predict</code> and <code>pred_ci</code> functions were all various ways of getting the predicted probability that Y=1 at some specific values of the coefficients.</p>
</section>
<section id="how-do-i-get-the-p-value-for-the-model-chi2" class="level1">
<h1>How do I get the P-value for the model <span class="math inline">\(\chi^2\)</span>?</h1>
<p>The p-value for the model <span class="math inline">\(\chi^2\)</span> statistic is the 3rd row of the output from <code>logregR2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logregR2</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi2                 647.888 
Df                   2 
Sig.                 &lt;.001 
Cox and Snell Index  0.477 
Nagelkerke Index     0.701 
McFadden's R2        0.568 </code></pre>
</div>
</div>
<p>If you want a more specific estimate of your p-value, you can get it by plugging a Chi2 statistic and the Degrees of freedom into this function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Chi2 <span class="ot">=</span> <span class="dv">15</span> <span class="co"># a chi2 value </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Df <span class="ot">=</span> <span class="dv">2</span>  <span class="co"># the degrees of freedom</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(Chi2, Df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0005530844</code></pre>
</div>
</div>
</section>
<section id="how-do-i-update-the-design-data" class="level1">
<h1>How do I update the design data?</h1>
<p>Any data set that ends in a capital D is a design data set. These are copies of the normal datasets (i.e.&nbsp;nesD is a design data version of the nes data set). If you want to change or add a new variable to design data, you need to follow a specific process:</p>
<ol type="1">
<li><p>Create one or more new variables in the regular (non-design) data set</p></li>
<li><p>Recreate the design data by passing the modified data to the <code>svydesign</code> function, making sure to specify the weights column</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating new variables in the regular NES data set</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>nes<span class="sc">$</span>dtherm_greater_than_50  <span class="ot">=</span> nes<span class="sc">$</span>ft_dem <span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>nes<span class="sc">$</span>libcpre_self_x.n <span class="ot">=</span> <span class="fu">as.numeric</span>(nes<span class="sc">$</span>libcpre_self_x)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># re-creating nesD dataset using the updated version of NES</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>nesD <span class="ot">=</span> <span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>nes, <span class="at">weights=</span><span class="sc">~</span>wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can just use the <code>update</code> function. The first argument is a design data set. Then you would write one or more new variable names followed by an expression that indicates how you want each variable to be calculated. So this is equivalent to the prior chunk of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># design_data = update(design_data, new_variable_name = some_expression ... )</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>nesD <span class="ot">=</span> <span class="fu">update</span>(nesD, <span class="at">dtherm_greater_than_50 =</span> ft_dem <span class="sc">&gt;</span> <span class="dv">50</span>,  </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">libcpre_self_x.n =</span> <span class="fu">as.numeric</span>(libcpre_self_x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="why-is-the-predict-function-giving-me-an-error-like-arguments-imply-differing-number-of-rows-or-newdata-had-x-rows-but-variables-found-have-x-rows" class="level1">
<h1>Why is the predict function giving me an error like “arguments imply differing number of rows…” or “‘newdata’ had X rows but variables found have X rows”?</h1>
<p>I’ve seen a couple of students with this error message on question 5. This comes from using the <code>$</code> annotation in your regression model. If you run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(states<span class="sc">$</span>obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> states<span class="sc">$</span>college, <span class="at">family=</span>binomial)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = states$obama_win12 == "Yes" ~ states$college, family = binomial)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -10.3392     3.0958  -3.340 0.000839 ***
states$college   0.4088     0.1223   3.342 0.000833 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 69.235  on 49  degrees of freedom
Residual deviance: 48.323  on 48  degrees of freedom
AIC: 52.323

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>The model coefficient is called <code>states$college</code>. When you run <code>predict</code> with new data, R tries to match the column names in your data set with the coefficients you named in your model, but since the coefficient is called <code>states$college</code>, it just ignores your new data and gives you everything with a warning like this one below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction when college = 20</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'newdata' had 1 row but variables found have 50 rows</code></pre>
</div>
</div>
<p>The fix for this is to use the <code>data</code> argument when running your regression model, instead of using the <code>$</code> annotation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> college, <span class="at">family=</span>binomial, <span class="at">data=</span>states)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction when college = 20 </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">'response'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.1031647 </code></pre>
</div>
</div>
<p>(and if you’re using <code>svyglm</code> you’d want to swap the <code>data</code> argument for the <code>design</code> argument)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">svyglm</span>(obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> college, <span class="at">family=</span>binomial, <span class="at">design=</span>statesD)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">'response'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  response     SE
1  0.10316 0.0699</code></pre>
</div>
</div>
</section>
<section id="how-do-i-calculcate-the-switchover-point" class="level1 page-columns page-full">
<h1>How do I calculcate the switchover point?</h1>
<p>The “switch over point” is the point where the predicted probability of Y=1 hits .5. Take this regression result:</p>
<div class="cell" data-warn="false">
<div class="cell-output-display">

<table class="huxtable" data-quarto-disable-processing="true" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  ">
<colgroup><col><col></colgroup><tbody><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.054&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.124)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">X1</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.751 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.082)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">nobs</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="2" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</tbody></table>

</div>
</div>
<div class="cell page-columns page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_hw_faq_files/figure-html/prediction%20for%20Y-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Predicted probabilities from the model. The red line is the switchover point</figcaption>
</figure>
</div>
</div></div></div>
<p>I want to find the value of X1 where the predicted probability is .5. This would be complicated if we were working with the probabilities because the effect of X on the probability of Y is nonlinear. But the effect of X on the logged odds of Y is linear. A probability of .5 corresponds to:</p>
<p>odds = <span class="math inline">\(.5/(1-.5) = 1\)</span></p>
<p>logged odds = <span class="math inline">\(ln[.5 / (1-.5)] = 0\)</span></p>
<p>So we can just find the value of X that gets us a logged odds of 0:</p>
<p><span class="math display">\[\beta_0 + \beta_1X_1 = 0\]</span></p>
<p>Subtract <span class="math inline">\(\beta_0\)</span> from both sides</p>
<span class="math display">\[\begin{align}


\beta_1X_1 \color{red}{- \beta_0} \color{black}{= 0} \color{red}{-\beta_0} = \\
\beta_1X_1 = -\beta_0

\end{align}\]</span>
<p>Then divide both sides by <span class="math inline">\(\beta_1\)</span></p>
<span class="math display">\[\begin{align}
\frac{\beta_1X_1}{\color{red}{\beta_1}} = \frac{-\beta_0}{\color{red}{\beta_1}} = \\

X_1 = \frac{-\beta_0}{\beta_1}


\end{align}\]</span>
<p>So, we just need to divide negative 1 times the intercept term by the coefficient to get the switchover point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> (<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span> <span class="sc">-</span><span class="fl">0.123</span>)<span class="sc">/</span>  <span class="fl">0.849</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1448763</code></pre>
</div>
</div>
<p>Plugging this value in to the logit line formula and calculating the predicted probability:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inverse.logit</span>(<span class="sc">-</span><span class="fl">0.1229</span> <span class="sc">+</span> <span class="fl">0.8493</span>  <span class="sc">*</span> <span class="fl">0.1448763</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5000359</code></pre>
</div>
</div>
<div class="cell page-columns page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_hw_faq_files/figure-html/Switchover%20point%20for%20Y-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Predicted probabilities from the model. The red line is the switchover point</figcaption>
</figure>
</div>
</div></div></div>
<p>Note: the basic logic doesn’t actually change much once you add an additional variable, as long as you account for it in the formula. For instance, if I want to find the switchover point with respect to X1 when X2 is equal to 1.7:</p>
<div class="cell">
<div class="cell-output-display">

<table class="huxtable" data-quarto-disable-processing="true" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  ">
<colgroup><col><col></colgroup><tbody><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.029&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.185)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">X1</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.878 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.163)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">X2</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3.634 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.270)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">nobs</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="2" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</tbody></table>

</div>
</div>
<p>Then I just need to find</p>
<span class="math display">\[\begin{align}
\frac{\beta_0 + \beta_2 X_2}{\beta_1}




\end{align}\]</span>
<span class="math display">\[\begin{align}


\frac{-1 \times  0.055 +-4.55 \times 1.7 }{2.14} \approx 0.199


\end{align}\]</span>
</section>
<section id="how-do-i-do-the-3d-plot-again" class="level1">
<h1>How do I do the 3d plot again?</h1>
<p>The <code>persp</code> function wants a an ordered set of numeric X values, an ordered set of numeric Y values, and then a set of Z values that correspond to the outcome at each level of X and Y. There are a number of ways to do this, but here are a couple:</p>
<section id="with-predict" class="level2">
<h2 class="anchored" data-anchor-id="with-predict">with predict</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>x1_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>x2_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span>x1_values , </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> x2_values)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get the predictions </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span>mynewdata, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> x1_values, </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> x2_values,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">z=</span> <span class="fu">matrix</span>(preds, </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow=</span><span class="fu">length</span>(x1_values),  </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="fu">length</span>(x2_values)),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"red"</span>, </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"black"</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="logit_hw_faq_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="pred_ci-with-xtabs" class="level2">
<h2 class="anchored" data-anchor-id="pred_ci-with-xtabs">pred_ci with xtabs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using the custom predictions function: </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/Neilblund/APAN/main/pred_ci.R"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>), <span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get the predictions </span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">pred_ci</span>(model, <span class="at">newdata=</span>mynewdata)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction ~ variable1 + variable2, data=predictiondata)</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">xtabs</span>(fit <span class="sc">~</span>   X1 <span class="sc">+</span>  X2, <span class="at">data=</span>preds) </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(z)), </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(z)),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">z=</span> z,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"gold"</span>, </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"purple"</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="logit_hw_faq_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="with-inverse.logit" class="level2">
<h2 class="anchored" data-anchor-id="with-inverse.logit">with inverse.logit</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>x1_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>x2_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span>x1_values , <span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> x2_values)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plugging in the coefficient values from the model: </span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">inverse.logit</span>(<span class="fl">0.05507</span>   <span class="sc">+</span>   <span class="fl">2.13854</span> <span class="sc">*</span> mynewdata<span class="sc">$</span>X1  <span class="sc">+</span>  <span class="sc">-</span><span class="fl">4.55033</span>  <span class="sc">*</span> mynewdata<span class="sc">$</span>X2)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> x1_values, </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> x2_values,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">z=</span>  <span class="fu">matrix</span>(z, </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow=</span><span class="fu">length</span>(x1_values), </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="fu">length</span>(x2_values)),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"#3b528b"</span>, </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"#fde725"</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="logit_hw_faq_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Don’t forget to set sensible values when you create your new data for the predictions! What values are “sensible” depends on the variable. Also, don’t forget to use <code>phi</code> and <code>theta</code> to adjust the viewing angle for the plot.</p>
</section>
</section>
<section id="error-in-glm-fit-something-about-not-being-meaningful-for-factors" class="level1">
<h1>error in glm fit … something about not being meaningful for factors</h1>
<p>Check to make sure you’re using <code>family=binomial</code> in your model. By default, the <code>glm</code> function will try to use a Gaussian link, which is basically the same thing as our normal linear regression model. So if you run something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">~</span> union10, <span class="at">data=</span> states)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in Ops.factor(y, mu): '-' not meaningful for factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in Ops.factor(eta, offset): '-' not meaningful for factors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in Ops.factor(y, mu): '-' not meaningful for factors</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in glm.fit(x = structure(c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, : NA/NaN/Inf in 'y'</code></pre>
</div>
</div>
<p>R will give you the error because it is expecting a numeric dependent variable. But if I specify that I want <code>family=binomial</code>, this should work fine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">~</span> union10, <span class="at">data=</span> states, <span class="at">family=</span>binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = obama_win08 ~ union10, family = binomial, data = states)

Coefficients:
(Intercept)      union10  
    -2.4639       0.2544  

Degrees of Freedom: 49 Total (i.e. Null);  48 Residual
Null Deviance:      68.59 
Residual Deviance: 52.01    AIC: 56.01</code></pre>
</div>
</div>
<p>One additional caution: pay close attention to the way that factor variables are coded. When converting factors to dichotomous variables for a logit model, it will assume that the 2nd category is the “success”. If you want to change this, you can either create a new variable, or you can add a logical statement to the model itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this would treat McCain winning as the 1 category. </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">==</span> <span class="st">"McCain win"</span> <span class="sc">~</span> union10, <span class="at">data=</span> states, <span class="at">family=</span>binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = obama_win08 == "McCain win" ~ union10, family = binomial, 
    data = states)

Coefficients:
(Intercept)      union10  
     2.4639      -0.2544  

Degrees of Freedom: 49 Total (i.e. Null);  48 Residual
Null Deviance:      68.59 
Residual Deviance: 52.01    AIC: 56.01</code></pre>
</div>
</div>
<p>The statistical meaning of this result is the same, but now we’re getting the effect on the probability of McCain winning instead of the probability of an Obama win.</p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "FAQs"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="an">code-annotations:</span><span class="co"> select</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">TRUE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>) </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poliscidata)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>fakedata<span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">X1  =</span> <span class="fu">rnorm</span>(N)<span class="sc">+</span><span class="fl">1.5</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">X2 =</span> <span class="fu">rnorm</span>(N),</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">Ystar =</span> X1 <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> X2 <span class="sc">*-</span><span class="dv">4</span> ,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">Y =</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="fu">inverse.logit</span>(Ystar))</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># How do I get coefficents/odds ratios/and percent change to odds from a logit?</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>Remember that the output from <span class="in">`summary`</span> is showing you the effect of a one unit increase in X on the logged odds of $Y=1$. Logit coefficients can take on any value from $-\infty$ to $\infty$. An odds ratio of 0 means there is no effect of X on Y.</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>model</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`orci`</span> function will transform the logit coefficients to odds ratios. Odds ratios can take any value from $0$ to $\infty$. An odds ratio of 1 means that there is no effect of X on Y. A number below 1 indicates a negative effect, and a number above 1 indicates a positive effect.</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="fu">orci</span>(model)</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>You can convert the odds ratios to a percent change in the odds of Y by running:</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>(<span class="fu">orci</span>(model) <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>Lastly, the <span class="in">`inverse.logit`</span>, <span class="in">`predict`</span> and <span class="in">`pred_ci`</span> functions were all various ways of getting the predicted probability that Y=1 at some specific values of the coefficients.</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="fu"># How do I get the P-value for the model $\chi^2$?</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>The p-value for the model $\chi^2$ statistic is the 3rd row of the output from <span class="in">`logregR2`</span>.</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a><span class="fu">logregR2</span>(model)</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>If you want a more specific estimate of your p-value, you can get it by plugging a Chi2 statistic and the Degrees of freedom into this function:</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>Chi2 <span class="ot">=</span> <span class="dv">15</span> <span class="co"># a chi2 value </span></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>Df <span class="ot">=</span> <span class="dv">2</span>  <span class="co"># the degrees of freedom</span></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(Chi2, Df)</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a><span class="fu"># How do I update the design data?</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>Any data set that ends in a capital D is a design data set. These are copies of the normal datasets (i.e. nesD is a design data version of the nes data set). If you want to change or add a new variable to design data, you need to follow a specific process:</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Create one or more new variables in the regular (non-design) data set</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Recreate the design data by passing the modified data to the <span class="in">`svydesign`</span> function, making sure to specify the weights column</span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a><span class="co"># creating new variables in the regular NES data set</span></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>nes<span class="sc">$</span>dtherm_greater_than_50  <span class="ot">=</span> nes<span class="sc">$</span>ft_dem <span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>nes<span class="sc">$</span>libcpre_self_x.n <span class="ot">=</span> <span class="fu">as.numeric</span>(nes<span class="sc">$</span>libcpre_self_x)</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a><span class="co"># re-creating nesD dataset using the updated version of NES</span></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>nesD <span class="ot">=</span> <span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data=</span>nes, <span class="at">weights=</span><span class="sc">~</span>wt)</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>Alternatively, you can just use the <span class="in">`update`</span> function. The first argument is a design data set. Then you would write one or more new variable names followed by an expression that indicates how you want each variable to be calculated. So this is equivalent to the prior chunk of code:</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a><span class="co"># design_data = update(design_data, new_variable_name = some_expression ... )</span></span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a>nesD <span class="ot">=</span> <span class="fu">update</span>(nesD, <span class="at">dtherm_greater_than_50 =</span> ft_dem <span class="sc">&gt;</span> <span class="dv">50</span>,  </span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a>                    <span class="at">libcpre_self_x.n =</span> <span class="fu">as.numeric</span>(libcpre_self_x))</span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a><span class="fu"># Why is the predict function giving me an error like "arguments imply differing number of rows..." or "'newdata' had X rows but variables found have X rows"?</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>I've seen a couple of students with this error message on question 5. This comes from using the <span class="in">`$`</span> annotation in your regression model. If you run:</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(states<span class="sc">$</span>obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> states<span class="sc">$</span>college, <span class="at">family=</span>binomial)</span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a>The model coefficient is called <span class="in">`states$college`</span>. When you run <span class="in">`predict`</span> with new data, R tries to match the column names in your data set with the coefficients you named in your model, but since the coefficient is called <span class="in">`states$college`</span>, it just ignores your new data and gives you everything with a warning like this one below:</span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction when college = 20</span></span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>))</span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>))</span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a>The fix for this is to use the <span class="in">`data`</span> argument when running your regression model, instead of using the <span class="in">`$`</span> annotation:</span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> college, <span class="at">family=</span>binomial, <span class="at">data=</span>states)</span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction when college = 20 </span></span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a>(and if you're using <span class="in">`svyglm`</span> you'd want to swap the <span class="in">`data`</span> argument for the <span class="in">`design`</span> argument)</span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">svyglm</span>(obama_win12 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> college, <span class="at">family=</span>binomial, <span class="at">design=</span>statesD)</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">college =</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a><span class="fu"># How do I calculcate the switchover point?</span></span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a>The "switch over point" is the point where the predicted probability of Y=1 hits .5. Take this regression result:</span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, warn=FALSE}</span></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a>huxtable<span class="sc">::</span><span class="fu">huxreg</span>(model, <span class="at">statistics=</span><span class="st">"nobs"</span>)</span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediction for Y</span></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Predicted probabilities from the model. The red line is the switchover point"</span></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: margin</span></span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a><span class="fu">predict_response</span>(model, <span class="at">terms=</span> <span class="sc">~</span>X1) <span class="sc">|&gt;</span><span class="fu">plot</span>(<span class="at">show_ci=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color=</span><span class="st">'red'</span>)</span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a>I want to find the value of X1 where the predicted probability is .5. This would be complicated if we were working with the probabilities because the effect of X on the probability of Y is nonlinear. But the effect of X on the logged odds of Y is linear. A probability of .5 corresponds to:</span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a>odds = $.5/(1-.5) = 1$</span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a>logged odds = $ln<span class="co">[</span><span class="ot">.5 / (1-.5)</span><span class="co">]</span> = 0$</span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a>So we can just find the value of X that gets us a logged odds of 0:</span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a>$$\beta_0 + \beta_1X_1 = 0$$</span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a>Subtract $\beta_0$ from both sides</span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align}</span></span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a><span class="in">\beta_1X_1 \color{red}{- \beta_0} \color{black}{= 0} \color{red}{-\beta_0} = \\</span></span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a><span class="in">\beta_1X_1 = -\beta_0</span></span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align}</span></span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a>Then divide both sides by $\beta_1$</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align}</span></span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a><span class="in">\frac{\beta_1X_1}{\color{red}{\beta_1}} = \frac{-\beta_0}{\color{red}{\beta_1}} = \\</span></span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a><span class="in">X_1 = \frac{-\beta_0}{\beta_1}</span></span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align}</span></span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a>So, we just need to divide negative 1 times the intercept term by the coefficient to get the switchover point.</span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a> (<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span> <span class="sc">-</span><span class="fl">0.123</span>)<span class="sc">/</span>  <span class="fl">0.849</span></span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a>Plugging this value in to the logit line formula and calculating the predicted probability:</span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a><span class="fu">inverse.logit</span>(<span class="sc">-</span><span class="fl">0.1229</span> <span class="sc">+</span> <span class="fl">0.8493</span>  <span class="sc">*</span> <span class="fl">0.1448763</span>)</span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Switchover point for Y</span></span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Predicted probabilities from the model. The red line is the switchover point"</span></span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: margin</span></span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a><span class="fu">predict_response</span>(model, <span class="at">terms=</span> <span class="sc">~</span>X1) <span class="sc">|&gt;</span><span class="fu">plot</span>(<span class="at">show_ci=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color=</span><span class="st">'red'</span>) <span class="sc">+</span> </span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="fl">0.1448763</span>, <span class="at">y=</span><span class="dv">0</span>, <span class="at">yend=</span>.<span class="dv">5</span>, <span class="at">col=</span><span class="st">'black'</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">x =</span> <span class="fl">0.1448763</span>,<span class="at">y=</span>.<span class="dv">65</span>, <span class="at">label=</span><span class="st">"x = .145"</span>)</span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a>Note: the basic logic doesn't actually change much once you add an additional variable, as long as you account for it in the formula. For instance, if I want to find the switchover point with respect to X1 when X2 is equal to 1.7:</span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, warning=FALSE}</span></span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)<span class="sc">|&gt;</span>huxtable<span class="sc">::</span><span class="fu">huxreg</span>(<span class="at">statistics =</span> <span class="st">'nobs'</span>)</span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-272"><a href="#cb37-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-273"><a href="#cb37-273" aria-hidden="true" tabindex="-1"></a>Then I just need to find</span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align}</span></span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a><span class="in">\frac{\beta_0 + \beta_2 X_2}{\beta_1} </span></span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align}</span></span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align}</span></span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a><span class="in">\frac{-1 \times  0.055 +-4.55 \times 1.7 }{2.14} \approx 0.199</span></span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align}</span></span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-294"><a href="#cb37-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-295"><a href="#cb37-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a><span class="fu"># How do I do the 3d plot again? </span></span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a>The <span class="in">`persp`</span> function wants a an ordered set of numeric X values, an ordered set of numeric Y values, and then a set of Z values that correspond to the outcome at each level of X and Y. There are a number of ways to do this, but here are a couple: </span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a><span class="fu">## with predict</span></span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=7}</span></span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-309"><a href="#cb37-309" aria-hidden="true" tabindex="-1"></a><span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb37-310"><a href="#cb37-310" aria-hidden="true" tabindex="-1"></a>x1_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a>x2_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>)</span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span>x1_values , </span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> x2_values)</span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a><span class="co"># get the predictions </span></span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span>mynewdata, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> x1_values, </span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> x2_values,</span>
<span id="cb37-321"><a href="#cb37-321" aria-hidden="true" tabindex="-1"></a>      <span class="at">z=</span> <span class="fu">matrix</span>(preds, </span>
<span id="cb37-322"><a href="#cb37-322" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow=</span><span class="fu">length</span>(x1_values),  </span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="fu">length</span>(x2_values)),</span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"red"</span>, </span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"black"</span>,</span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a><span class="fu">## pred_ci with xtabs</span></span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-339"><a href="#cb37-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=7}</span></span>
<span id="cb37-340"><a href="#cb37-340" aria-hidden="true" tabindex="-1"></a><span class="co"># using the custom predictions function: </span></span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/Neilblund/APAN/main/pred_ci.R"</span>)</span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>), <span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>))</span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a><span class="co"># get the predictions </span></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">pred_ci</span>(model, <span class="at">newdata=</span>mynewdata)</span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-353"><a href="#cb37-353" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction ~ variable1 + variable2, data=predictiondata)</span></span>
<span id="cb37-354"><a href="#cb37-354" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">xtabs</span>(fit <span class="sc">~</span>   X1 <span class="sc">+</span>  X2, <span class="at">data=</span>preds) </span>
<span id="cb37-355"><a href="#cb37-355" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(z)), </span>
<span id="cb37-356"><a href="#cb37-356" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(z)),</span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a>  <span class="at">z=</span> z,</span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"gold"</span>, </span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"purple"</span>,</span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a><span class="fu">## with inverse.logit</span></span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=7}</span></span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb37-378"><a href="#cb37-378" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 , <span class="at">family=</span>binomial, <span class="at">data=</span>fakedata)</span>
<span id="cb37-379"><a href="#cb37-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a>x1_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>)</span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a>x2_values <span class="ot">=</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span>.<span class="dv">1</span>)</span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a><span class="co"># make the new data </span></span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a>mynewdata <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span>x1_values , <span class="co"># sensible hypothetical values for me, but maybe not for you! </span></span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a>                      <span class="at">X2 =</span> x2_values)</span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a><span class="co"># plugging in the coefficient values from the model: </span></span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">inverse.logit</span>(<span class="fl">0.05507</span>   <span class="sc">+</span>   <span class="fl">2.13854</span> <span class="sc">*</span> mynewdata<span class="sc">$</span>X1  <span class="sc">+</span>  <span class="sc">-</span><span class="fl">4.55033</span>  <span class="sc">*</span> mynewdata<span class="sc">$</span>X2)</span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(<span class="at">x =</span> x1_values, </span>
<span id="cb37-395"><a href="#cb37-395" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> x2_values,</span>
<span id="cb37-396"><a href="#cb37-396" aria-hidden="true" tabindex="-1"></a>      <span class="at">z=</span>  <span class="fu">matrix</span>(z, </span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow=</span><span class="fu">length</span>(x1_values), </span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="fu">length</span>(x2_values)),</span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticktype=</span><span class="st">"detailed"</span>,</span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta=</span><span class="sc">-</span><span class="dv">130</span>, <span class="co"># theta controls the horizontal rotation</span></span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi=</span><span class="dv">20</span>,  <span class="co"># phi controls the vertical rotation</span></span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">"#3b528b"</span>, </span>
<span id="cb37-403"><a href="#cb37-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"#fde725"</span>,</span>
<span id="cb37-404"><a href="#cb37-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab=</span><span class="st">"X1"</span>, </span>
<span id="cb37-405"><a href="#cb37-405" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">"X2"</span>,</span>
<span id="cb37-406"><a href="#cb37-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab=</span><span class="st">"Pr (Y=1)"</span>)</span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a>Don't forget to set sensible values when you create your new data for the predictions! What values are "sensible" depends on the variable. Also, don't forget to use <span class="in">`phi`</span> and <span class="in">`theta`</span> to adjust the viewing angle for the plot. </span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a><span class="fu"># error in glm fit ... something about not being meaningful for factors</span></span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a>Check to make sure you're using <span class="in">`family=binomial`</span> in your model. By default, the <span class="in">`glm`</span> function will try to use a Gaussian link, which is basically the same thing as our normal linear regression model. So if you run something like this: </span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">~</span> union10, <span class="at">data=</span> states)</span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a>R will give you the error because it is expecting a numeric dependent variable. But if I specify that I want <span class="in">`family=binomial`</span>, this should work fine: </span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">~</span> union10, <span class="at">data=</span> states, <span class="at">family=</span>binomial)</span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-433"><a href="#cb37-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-434"><a href="#cb37-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-435"><a href="#cb37-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-436"><a href="#cb37-436" aria-hidden="true" tabindex="-1"></a>One additional caution: pay close attention to the way that factor variables are coded. When converting factors to dichotomous variables for a logit model, it will assume that the 2nd category is the "success". If you want to change this, you can either create a new variable, or you can add a logical statement to the model itself: </span>
<span id="cb37-437"><a href="#cb37-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-438"><a href="#cb37-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-441"><a href="#cb37-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-442"><a href="#cb37-442" aria-hidden="true" tabindex="-1"></a><span class="co"># this would treat McCain winning as the 1 category. </span></span>
<span id="cb37-443"><a href="#cb37-443" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(obama_win08 <span class="sc">==</span> <span class="st">"McCain win"</span> <span class="sc">~</span> union10, <span class="at">data=</span> states, <span class="at">family=</span>binomial)</span>
<span id="cb37-444"><a href="#cb37-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-445"><a href="#cb37-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-446"><a href="#cb37-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-447"><a href="#cb37-447" aria-hidden="true" tabindex="-1"></a>The statistical meaning of this result is the same, but now we're getting the effect on the probability of McCain winning instead of the probability of an Obama win.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>